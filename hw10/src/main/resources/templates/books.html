<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">


<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title>Library | Books</title>
    <link href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">

    <script>
        function getDataByFetch() {
            fetch('books/all')
                 .then(response => response.json())
                 .then(json => outputData(json))
                 .catch(error => console.error('Error:', error));
        }

        function getDataByFetchFind() {
            fetch('books/find')
                .then(response => response.json())
                .then(json => outputDataFind(json))
                .catch(error => console.error('Error:', error));
        }
    
        function outputData(books) {
            let parent = document.querySelector('#dataContainer');
            books.forEach(book => {
                let tr = document.createElement('tr');
                let td1 = document.createElement('td');
                let td2 = document.createElement('td');
                let td3 = document.createElement('td');
                let td4 = document.createElement('td');
                td1.textContent = book.id;
                td2.textContent = book.title;
                td3.textContent = book.author.id;
                td4.textContent = book.genre.id;
	            tr.appendChild(td1);
                tr.appendChild(td2);
                tr.appendChild(td3);
                tr.appendChild(td4);
	            parent.appendChild(tr);
            });
        }
    </script>

</head>


<style>
    h1 {
        margin-bottom: 40px;
        margin-top: 20px;
    }

    div {
        margin-bottom: 10px;
        margin-top: 15px;
    }
</style>


<body class="container" onload="getDataByFetch()">


<!-- Breadcrumb -->
<ol class="breadcrumb p-3 bg-body-tertiary rounded-3">
    <li class="breadcrumb-item"><a th:href="'/'">Home</a></li>
    <li class="breadcrumb-item"><a th:href="'/books'">Books</a></li>
</ol>


<h1 class="align-middle text-center">
    Library | Books
</h1>


<!-- All books / Founded book by Id -->
<hr>
<div>
    <h4 class="align-middle text-center">
        All books / Founded book by Id
    </h4>
</div>
<hr>

<table class="table table-striped table-bordered">
    <thead class="align-middle text-center">
    <tr>
        <th>Book.Id</th>
        <th>Book.Title</th>
        <th>Book.Author (Id / FullName)</th>
        <th>Book.Genre (Id / Name)</th>
    </tr>
    </thead>
    <tbody id="dataContainer">
    </tbody>
</table>


<!-- Insert new book -->
<hr>
<div>
    <h4 class="align-middle text-center">
        Insert new book
    </h4>
</div>
<hr>

</body>
<form th:method="POST" th:action="@{/books/create}" th:object="${book_create_obj}" class="align-middle text-center">
    <div>
        <label for="title-input">Enter the title of the new book -></label>
        <input id="title-input" type="text" th:field="*{title}">
    </div>
    <div>
        <label for="author-id-input">Enter the Id of the author of the new book -></label>
        <input id="author-id-input" type="text" th:field="*{authorId}">
    </div>
    <div>
        <label for="genre-id-input">Enter the genre Id of the new book -></label>
        <input id="genre-id-input" type="text" th:field="*{genreId}">
    </div>
    <div>
        <button type="submit" class="btn btn-success rounded-pill px-3">Add new book</button>
    </div>
</form>


<!-- Update book by Id -->
<hr>
<div>
    <h4 class="align-middle text-center">
        Update book by Id
    </h4>
</div>
<hr>

<form th:method="post" th:action="@{/books/update}" th:object="${book_update_obj}" class="align-middle text-center">
    <div>
        <label for="id-update-input">Enter the Id of the book you want to edit -></label>
        <input id="id-update-input" type="text" th:field="*{id}">
    </div>
    <div>
        <label for="title-update-input">Enter a new title for the book -></label>
        <input id="title-update-input" type="text" th:field="*{title}">
    </div>
    <div>
        <label for="author-update-id-input">Enter the new author's Id for the book -></label>
        <input id="author-update-id-input" type="text" th:field="*{authorId}">
    </div>
    <div>
        <label for="genre-update-id-input">Enter the new genre's Id for the book -></label>
        <input id="genre-update-id-input" type="text" th:field="*{genreId}">
    </div>
    <div>
        <button type="submit" class="btn btn-warning rounded-pill px-3">Update book</button>
    </div>
</form>


<!-- Find book by Id -->
<hr>
<div>
    <h4 class="align-middle text-center">
        Find book by Id
    </h4>
</div>
<hr>

<form th:method="get" th:action="@{/books/find}" class="align-middle text-center">
    <div>
        <label for="id-find-input">Enter the Id of the book you want to find -></label>
        <input id="id-find-input" type="text" name="book_id">
    </div>
    <div>
        <button type="submit" class="btn btn-info rounded-pill px-3" onclick="getDataByFetchFind()">Find</button>
    </div>
</form>


<!-- Delete book by Id -->
<hr>
<div>
    <h4 class="align-middle text-center">
        Delete book by Id
    </h4>
</div>
<hr>

<form th:method="post" th:action="@{/books/delete}" class="align-middle text-center">
    <div>
        <label for="id-input">Enter the Id of the book you want to delete -></label>
        <input id="id-input" type="text" name="book_id">
    </div>
    <div>
        <button type="submit" class="btn btn-danger rounded-pill px-3">Delete</button>
    </div>
</form>

<hr>

</body>

</html>